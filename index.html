<!DOCTYPE html>
<html lang="en">
<title>Mortgage Data Visualization</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-black.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">

<style>
html,body,h1,h2,h3,h4,h5,h6 {font-family: "Roboto", sans-serif;}
.w3-sidebar {
  z-index: 3;
  width: 250px;
  top: 43px;
  bottom: 0;
  height: inherit;
}
table, th, td {
  border: 1px solid black;
  border-collapse: collapse;

}
table.centert {
    margin-left:auto; 
    margin-right:auto;

  }
th, td {
  padding: 5px;
  text-align: left;
}
th {
  background-color: #45a29e;
  font-weight: normal;
  color: white;
}
table#t01 tr:nth-child(even) {
  background-color: #eee;
}
table#t01 tr:nth-child(odd) {
 background-color: #fff;
}
.w3-bar {
  margin-right: 5%;
}
.center {
  display: block;
  margin-left: auto;
  margin-right: auto;
  width: 90%;
}
.center50 {
  display: block;
  margin-left: auto;
  margin-right: auto;
  width: 50%;
}
#imIn { display: inline-block; }

/*.rowi {
  display: flex;
}

.columni {
  flex: 33.33%;
  /*padding: 5px;*/

/*figure {
    width: 33%;
    float: left;
    margin: 0;
    text-align: center;
    padding: 0;
}*/

</style>

<!-- Header -->
<header class="w3-container w3-center w3-padding-32" style="background-color: #0B0C10; color: #66FCF1" position= "fixed"> 
  <h1><b>Mortgate Data Visualization</b></h1>
  <p>Tina Nguyen</p>
</header>

<body>

<!-- Navbar -->
<div class="w3-top" >
  <div class="w3-bar w3-theme w3-top w3-left-align w3-large">
    <a class="w3-bar-item w3-button w3-right w3-hide-large w3-hover-white w3-large w3-theme-l1" href="javascript:void(0)" onclick="w3_open()"><i class="fa fa-bars"></i></a>
    <a href="#" class="w3-theme-l1">Mortgage Data Visualization</a>
<!--     <a href="#" class="w3-bar-item w3-button w3-hide-small w3-hover-white">About</a>
    <a href="#" class="w3-bar-item w3-button w3-hide-small w3-hover-white">Values</a>
    <a href="#" class="w3-bar-item w3-button w3-hide-small w3-hover-white">News</a>
    <a href="#" class="w3-bar-item w3-button w3-hide-small w3-hover-white">Contact</a>
    <a href="#" class="w3-bar-item w3-button w3-hide-small w3-hide-medium w3-hover-white">Clients</a>
    <a href="#" class="w3-bar-item w3-button w3-hide-small w3-hide-medium w3-hover-white">Partners</a> -->
  </div>
</div>

<!-- Sidebar -->
<nav class="w3-sidebar w3-bar-block w3-collapse w3-card w3-animate-left" style="background-color:#1F2833; color: white; margin-top: -15px" id="mySidebar">
  <a href="javascript:void(0)" onclick="w3_close()" class="w3-right w3-xlarge w3-padding-large w3-hover-black w3-hide-large" title="Close Menu">
    <i class="fa fa-remove"></i>
  </a>
  <h4 class="w3-bar-item"><b>Menu</b></h4>
  <a class="w3-bar-item w3-button w3-hover-black" href="#intro">I. Introduction</a>
  <a class="w3-bar-item w3-button w3-hover-black" href="#data">II. Data</a>
  <a class="w3-bar-item w3-button w3-hover-black" href="#eda">III. Exploratory Data Analysis</a>
  <a class="w3-bar-item w3-button w3-hover-black" href="#models">IV. Modeling</a>
  <a class="w3-bar-item w3-button w3-hover-black" href="#con">V. Conclusion</a>
</nav>


<!-- Overlay effect when opening sidebar on small screens -->
<div class="w3-overlay w3-hide-large" onclick="w3_close()" style="cursor:pointer" title="close side menu" id="myOverlay"></div>

<!-- Main content: shift it to the right by 250 pixels when the sidebar is visible -->
<div class="w3-main" style="margin-left:250px">

  <div id="intro" class="w3-row w3-padding-32">
    <div class="w3-twothird w3-container">
      <h3 class="w3-text-teal" ><b>I. Introduction</b></h3>
      <p>Mortgage default occurs when a borrower fails to make a repayment to the lender. This project analyzes the characterics of borrowers and loans that would later default using the data available at origination. Being able to flag a bad loan before making a funding decision is an ideal scenario for both the lenders and borrowers. The lenders would be more careful about funding that loan, while the borrowers, if rejected, are not taking more debt than they can repay. Therefore, being able to flag a loan at the origination state is very important. </p>

    </div>
<!--     <div class="w3-third w3-container">
      <p class="w3-border w3-padding-large w3-padding-32 w3-center">AD</p>
      <p class="w3-border w3-padding-large w3-padding-64 w3-center">AD</p>
    </div> -->
  </div>

  <div id="data" class="w3-row">
    <div class="w3-twothird w3-container">
      <h3 class="w3-text-teal" style="margin-top: -1%" ><b>II. Data</b></h3>
      <h5><b>1. Data Source </b></h5>
<p>This project uses Freddie Mac Single Family Loan Level Data and performs analysis on all loans funded by Freddie Mac between 2010 and 2018. The data was obtained from Freddie Mac website in as zip files. Every zip file contains data of the entire year which was broken down into data of each quarter. Each quarter contains two different text files: (1) Origination Data and (2) Performance Data. The structure of the data is as follow:  </p>
<ul>
    <li>historical_data_200X.zip</li>
    <ul>
        <li>historical_data1_Q1200X.zip</li>
        <li>historical_data1_Q2200X.zip</li>
        <li>historical_data1_Q3200X.zip</li>
        <li>historical_data1_Q4200X.zip</li>
        <ul>
            <li>historical_data1_Q1200X.txt (Origination Data)</li>
            <li>historical_data1_time_Q1200X.txt (Performance Data)</li>
        </ul></ul></ul>
      
<p>The 30-year fixed mortgage interest rate downloaded from Freddie Mac website contains the monthly interest rate for 30-year fix-rate mortgages between 2013 and 2018. This variable was later used in calculating the rate of Spread at Origination (SATO). 
The Origination data contains variables that indicate the characteristics of the borrowers, the loans, and the properties. More specifically:<p>
<ol>
<li>  Borrower characteristics: Credit Score, First Time Homebuyer, Debt-to-Income (DTI), Total number of Borrowers </li>
<li>  Loans characteristics: Date of First Payment, Maturity Date, Mortgage Insurance (MI) Percentage, Combined Loan-to-Value, Loan-to-Value (LTV), Interest Rate, Channel, Loan Purpose, Term, Seller, Servicer, Conformity Flag, Unpaid Principal Balance, Quarter and Year when the loan was funded </li>
<li>  Property characteristics: Metropolitan Statistical Areas (MSA) , Unit, Occupancy Status, Property State, Property Type, Postal Code </li>
 </ol>  
 
<img align="middle" src='header.PNG' class="center" />
<br>
<p>The Performance data contains information on how the loans perform monthly. It contains variable such as Current Unpaid Principal Balance, Loan Status, Loan Age, Number of Years to Maturity, etc. For the purpose of this study, only variable Loan Status from Performance data was used.</p>
  <h5><b>2. Data Preprocessing </b></h5>
  <ul>
    <li>Extract zip files into text files </li>
    <li>Import all origination files, concatenate them into one dataframe, and replace placeholder values with NaN </li>
    <li>Select loans that delinquent for more than 90 days from performance data</li>
    <li>Merge unique loan ids from performance data to orignation data</li>
    <li>Remove all NaN values </li>
    <li>Calculate the average interest rate for every quarter using Excel</li>
    <li>Merge the quarterly interest rate to the master dataframe</li>
    <li>Calculate the Spread at Orgination (SATO) rate </li>
    <strong>SATO (%) = Average Fixed Rate - Stated Interest Rate</strong>
</ul>
  <p>The code below is a snipet of the data cleaning process.</p>
  <img align="middle" src='code_snipet.PNG' class="center" />
  <br>
    </div>
<!--     <div class="w3-third w3-container">
      <p class="w3-border w3-padding-large w3-padding-32 w3-center">AD</p>
      <p class="w3-border w3-padding-large w3-padding-64 w3-center">AD</p>
    </div> -->
  </div>

  <div id="eda" class="w3-row w3-padding-64">
    <div class="w3-twothird w3-container">
      <h3 class="w3-text-teal" style="margin-top: -1%" ><b>III. Exploratory Data Analysis</b></h3>
      <h5><b>1. Geographical Distribution</b> </h5>
      <div class='tableauPlaceholder' id='viz1588630766058' style='position: relative'><noscript><a href='#'><img alt=' ' src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;ED&#47;EDA_15881893307010&#47;Population&#47;1_rss.png' style='border: none' /></a></noscript><object class='tableauViz'  style='display:none;'><param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' /> <param name='embed_code_version' value='3' /> <param name='site_root' value='' /><param name='name' value='EDA_15881893307010&#47;Population' /><param name='tabs' value='yes' /><param name='toolbar' value='yes' /><param name='static_image' value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;ED&#47;EDA_15881893307010&#47;Population&#47;1.png' /> <param name='animate_transition' value='yes' /><param name='display_static_image' value='yes' /><param name='display_spinner' value='yes' /><param name='display_overlay' value='yes' /><param name='display_count' value='yes' /><param name='filter' value='publish=yes' /></object></div>                <script type='text/javascript'>                    var divElement = document.getElementById('viz1588630766058');                    var vizElement = divElement.getElementsByTagName('object')[0];                    vizElement.style.width='100%';vizElement.style.height=(divElement.offsetWidth-200)+'px';                    var scriptElement = document.createElement('script');                    scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';                    vizElement.parentNode.insertBefore(scriptElement, vizElement);                </script>
  <br>
  <p>Tab Overview shows the total number of loans funded in each state. Click on any state in the first plot to see the corresponding total by year in the second plot.</p>
  <p>Tab Population (%) compares the number of loans in serious delinquency vs performing loans.</p>
  <p>Tab Top States with Delinquency shows the top 5 states with the highest rate of delinquency.</p>
  <p>During the 2013-2018 period, Freddie Mac purchased the most properties in California, Texas, Florida, and Ohio. These states were also the ones with the highest delinquency rates. The total number of delinquency in these states made up about 50% of all delinquency in the US.</p>
 
    <h5><b>2. Borrowers and Loans' Characteristics</b> </h5>
  <div class='tableauPlaceholder' id='viz1588633182512' style='position: relative'><noscript><a href='#'><img alt=' ' src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Co&#47;Comparisons_15881859506950&#47;Mean&#47;1_rss.png' style='border: none' /></a></noscript><object class='tableauViz'  style='display:none;'><param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' /> <param name='embed_code_version' value='3' /> <param name='site_root' value='' /><param name='name' value='Comparisons_15881859506950&#47;Mean' /><param name='tabs' value='yes' /><param name='toolbar' value='yes' /><param name='static_image' value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Co&#47;Comparisons_15881859506950&#47;Mean&#47;1.png' /> <param name='animate_transition' value='yes' /><param name='display_static_image' value='yes' /><param name='display_spinner' value='yes' /><param name='display_overlay' value='yes' /><param name='display_count' value='yes' /><param name='filter' value='publish=yes' /></object></div>                <script type='text/javascript'>                    var divElement = document.getElementById('viz1588633182512');                    var vizElement = divElement.getElementsByTagName('object')[0];                    vizElement.style.width='100%';vizElement.style.height=(divElement.offsetWidth-200)+'px';                    var scriptElement = document.createElement('script');                    scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';                    vizElement.parentNode.insertBefore(scriptElement, vizElement);                </script>
  <br>
  <p>The plots above calculate the average of each numberical characteristics and compare between performning loans and delinquent loans. Overall, average DTI, LTV, MI percentage, and interest rate of default loans are higher than performing loans. Average credit score and SATO rate of delinquent loans are higher than performing loans. The wide gap in SATO rate between these loan statuses indicates on average, both perfoming loans and delinquent loans received higher interest rates than market average. Additionally, loans that would later delinquent received a much higher interest rates at origination than loans that would later perform.</p>
    </div>
<!--     <div class="w3-third w3-container">
      <p class="w3-border w3-padding-large w3-padding-32 w3-center">AD</p>
      <p class="w3-border w3-padding-large w3-padding-64 w3-center">AD</p>
    </div> -->
  </div>

  <div id="models" class="w3-row">
    <div class="w3-twothird w3-container">
      <h3 class="w3-text-teal" style="margin-top: -1%"><b>IV. Modeling</b></h3>
      <p>Before modeling, One Hot Encoder was applied to categorical values and Label Encoder was applied to the target.
    The data was standardized and split into training and testing sets with the ratio of 7:3.
    The dataset was resampled twice to compare the results of different sampling techinques.
    Classifiers such as Logistic Regression, Decision Tree, and XGBoost were applied.
    Models were evaluated using precision score.
    The code below fits different classifers and returns the scores for each model.</p>
  <img align="middle" src='code_snipet2.PNG' class="center" />
  <br>
<!--   <div class="rowi">
  <div class="columni">
    <figure>
    <img src='full pop.png' class="center50" >
    <figcaption style="text-align: center; font-style: italic; font-style: xx-small">Fig.4 - Full population</figcaption>
    </figure>
  </div>
  <div class="columni">
    <figure>
    <img src='under50.png' class="center50">
    <figcaption style="text-align: center; font-style: italic; font-style: xx-small">Fig.5 - Undersampling</figcaption>
    </figure>
  </div>
  <div class="columni">
    <img src='combine pop.png' class="center50"  >
    <figcaption style="text-align: center; font-style: italic; font-style: xx-small">Fig.6 - Combination</figcaption>
    </figure>
  </div>
</div> -->


<!--     <div id="imIn">
<img style="display: inline; margin: 0 5px;" title="heartica_logo" src="full pop.png" alt="" width="30%" height="30%" />
<img style="display: inline; margin: 0 5px;" title="mouseflow_logo" src="under50.png" alt="" width="30%" height="30%" />
<img style="display: inline; margin: 0 5px;" title="piiholo_logo" src="combine.png" alt="" width="30%" height="30%" />


</div> -->
  
  <h5><b>1. Base Model - Full Population</b></h5>
  
  <figure>
  <img align="middle" src='full pop.png' class="center50" >
  <figcaption style="text-align: center; font-style: italic; font-style: xx-small">Fig.4 - Full population</figcaption>
  </figure>
  
  <p>The plot above shows the class distribution of all loans funded between 2013 and 2018. In the original population, the classes are very skewed. </p>
  <table class='centert' style="overflow-x:auto" id="t01">
  <tr>
    <th>Model</th>
    <th>Precision Score Training</th>
    <th>F1 Score Training</th>
    <th>Precision Score Testing</th>
    <th>F1 Score Testing</th>
  </tr>
  <tr>
    <td>Logistic Regression</td>
      <td>0.996</td>
      <td>0.498</td>
    <td>0.992</td>
    <td>0.996</td>
  </tr>
  <tr>
    <td>Decision Tree</td>
    <td>1.0</td>
      <td>1.0</td>
      <td>0.512</td>
    <td>0.514</td>
  </tr>
    <tr>
    <td>XGBoost</td>
        <td>0.996</td>
        <td>0.500</td>
    <td>0.829</td>
    <td>0.499</td>
  </tr>
</table>
  
  <h5><b>2. Undersampling 50% </b></h5>
  
  <figure>
  <img align="middle" src='under50.png' class="center50">
  <figcaption style="text-align: center; font-style: italic; font-style: xx-small">Fig.5 - Undersampling</figcaption>
  </figure>

  <p>Undersampling is applied so that the majority class is 50% more than the miniory class. The above plot shows the class distribution after resampling.</p>
  <table class="centert" style="overflow-x:auto" id="t01">
  <tr>
    <th>Model</th>
    <th>Precision Score Training</th>
    <th>F1 Score Training</th>
    <th>Precision Score Testing</th>
    <th>F1 Score Testing</th>
  </tr>
  <tr>
    <td>Logistic Regression</td>
      <td>0.752</td>
      <td>0.735</td>
    <td>0.515</td>
    <td>0.497</td>
  </tr>
  <tr>
    <td>Decision Tree</td>
    <td>1.0</td>
      <td>1.0</td>
      <td>0.507</td>
    <td>0.452</td>
  </tr>
    <tr>
    <td>XGBoost</td>
        <td>0.817</td>
        <td>0.809</td>
    <td>0.515</td>
    <td>0.494</td>
  </tr>
</table>
  
  <h5><b>3. Combination</b></h5>

  <figure>
  <img align="middle" src='combine pop.png' class="center50"  >
  <figcaption style="text-align: center; font-style: italic; font-style: xx-small">Fig.6 - Combination</figcaption>
  </figure>

  <p>The above plot shows the class distribution after the data was oversampled by 20% and undersampled by 30%.</p>
  <table class='centert' style="overflow-x:auto" id="t01">
  <tr>
    <th>Model</th>
    <th>Precision Score Training</th>
    <th>F1 Score Training</th>
    <th>Precision Score Testing</th>
    <th>F1 Score Testing</th>
  </tr>
  <tr>
    <td>Logistic Regression</td>
      <td>0.747</td>
      <td>0.695</td>
    <td>0.521</td>
    <td>0.524</td>
  </tr>
  <tr>
    <td>Decision Tree</td>
    <td>1.0</td>
      <td>1.0</td>
      <td>0.511</td>
    <td>0.514</td>
  </tr>
    <tr>
    <td>XGBoost</td>
        <td>0.792</td>
        <td>0.761</td>
    <td>0.523</td>
    <td>0.526</td>
  </tr>
</table>
  
  <div id="con" class="w3-row">
    <div class="w3-twothird w3-container">
      <h3 class="w3-text-teal" style="padding-top: 3%"><b>V. Conclusion</b></h3>
      
  <p>Through extensive analysis, this study:
<ul>
<li>Identified the states with the most delinquency rate</li>
<li>Profiled the characteristics of delinquent and performing loans</li>
<ul><li>Discovered the relationship between SATO and delinquent loans</li></ul>
<li>Experimented with different combinations of classifiers and resampling techniques</li>
  </ul></p>
    </div>
<!--     <div class="w3-third w3-container">
      <p class="w3-border w3-padding-large w3-padding-32 w3-center">AD</p>
      <p class="w3-border w3-padding-large w3-padding-64 w3-center">AD</p>
    </div> -->
  </div>

  <!-- Pagination -->
 <!--  <div class="w3-center w3-padding-32">
    <div class="w3-bar">
      <a class="w3-button w3-black" href="#">1</a>
      <a class="w3-button w3-hover-black" href="#">2</a>
      <a class="w3-button w3-hover-black" href="#">3</a>
      <a class="w3-button w3-hover-black" href="#">4</a>
      <a class="w3-button w3-hover-black" href="#">5</a>
      <a class="w3-button w3-hover-black" href="#">»</a>
    </div>
  </div> -->


    <div class="w3-container w3-theme-l1">
      <p>Powered by <a href="https://www.w3schools.com/w3css/default.asp" target="_blank">w3.css</a></p>
    </div>
  </footer>

<!-- END MAIN -->
</div>

<script>
// Get the Sidebar
var mySidebar = document.getElementById("mySidebar");

// Get the DIV with overlay effect
var overlayBg = document.getElementById("myOverlay");

// Toggle between showing and hiding the sidebar, and add overlay effect
function w3_open() {
  if (mySidebar.style.display === 'block') {
    mySidebar.style.display = 'none';
    overlayBg.style.display = "none";
  } else {
    mySidebar.style.display = 'block';
    overlayBg.style.display = "block";
  }
}

// Close the sidebar with the close button
function w3_close() {
  mySidebar.style.display = "none";
  overlayBg.style.display = "none";
}
</script>

</body>
</html>
